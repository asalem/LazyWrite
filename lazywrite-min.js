/*
 * LazyWrite - deferred document.write implementation
 * Version: 1.0 beta build 20110224
 * Website: http://github.com/xfsn/LazyWrite
 * 
 * Copyright (c) 2011 Shen Junru
 * Released under the MIT License.
 */
(function(x,p,h){var E=1,g=!-[1,],z=g?"onreadystatechange":"onload",l=/^\s*<!--/,m=x.write,y=x.writeln,b=x.createDocumentFragment(),u=x.createElement("div"),A=h,t=h,i=h,j=h,e=[],f=[],s=false,c=true,k=[].join,F=function(I,H){return I.appendChild(H)},q=function(H){return H.parentNode?H.parentNode.removeChild(H):H},a=function(I,H){return I.parentNode.replaceChild(H,I)&&H},w=function(){return x.createElement("span")},D=function n(I){var H=x.createElement("script");H.type=I.type;if(I.src){H.src=I.src}else{H.text=I.text}return H},C=function(I,H){if(H.src){H[z]=function(){var K=g&&H.readyState;if(!H.done&&(!K||/complete|loaded/.test(K))){if(K==="loaded"&&!H.loaded){H.loaded=true;setTimeout(arguments.callee)}else{H.done=true;H[z]=null;q(I);if(t===H){t=h;d()}}}};t=H;setTimeout(function(){F(I,H)})}else{try{p(H.text.replace(l,""))}catch(J){}q(I)}},v=function(H){if(H){if(!t){A=H.holder}C(H.holder,H.script=D(H.script));return !H.script.src}},B=function(H){while((H=v(f.shift()))){}return H!==false&&!t},r=function(K,L,J){if(g){u.innerHTML="<img />"+L;q(u.firstChild)}else{u.innerHTML=L}var I=[],H=u.getElementsByTagName("script");while(H[0]){I.push({script:H[0],holder:a(H[0],element=w())})}f=I.concat(f);while(u.firstChild){b.appendChild(u.firstChild)}if(i===K){j.parentNode.insertBefore(b,j)}else{j=b.appendChild(j||w());J?K.parentNode.insertBefore(b,K.nextSibling):a(K,b)}i=K;if(I.length){c=B()}return c},G=function(H){return H&&H.html&&r(x.getElementById(H.id),H.html)},o=function(H){while(G(e.shift())){}if(c&&!e.length){j&&q(j);b=u=A=t=i=j=h;x.write=m;x.writeln=y}},d=function(){c=true;if(B()){o()}};x.writeln=x.write=function(){var J,I=k.call(arguments,"");if(I){if(s){try{r(A,I,true)}catch(H){}}else{e.push({id:J="document_write_"+E++,html:I});J='<span id="'+J+'"></span>';m.call?m.call(x,J):m(J)}}};window.LazyWrite={write:function(){m.apply(x,arguments)},render:function(H,I){H&&I&&e.push({id:H,html:I})},start:function(){if(s){return}s=true;o()}}})(document,function(){eval.apply(window,arguments)});
