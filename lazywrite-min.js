/*! LazyWrite 1.2 (sha1: 92a9f46e8bbebbd3d6a84e1b0c6ae2f4cae30075) | (c) 2011 Shen Junru. MIT License. | http://github.com/shenjunru/LazyWrite */
(function(e,t,n,r,i){"function"==typeof define&&define.amd?define(function(){return e(t,n,r,i,!1)}):n.LazyWrite=e(t,n,r,i,!1!==n.AUTO_LAZYWRITE)})(function(e,t,n,r,i,s){function M(e){x.errors.push(e)}function _(e,t){return e.appendChild(t)}function D(e){return e.parentNode?e.parentNode.removeChild(e):e}function P(e,t){return e.parentNode.replaceChild(t,e)&&t}function H(e){return n.createElement(e)}function B(){return H("span")}function j(e){var t=H("script");return t.type=e.type,e.src?t.src=e.src:t.text=e.text,t}function F(e,t,n){clearTimeout(n.timeout),n.done=!0,t.onerror=t[f]="",D(e),n===g&&(g=s,X())}function I(t,n){if(n.src){var i={src:n.src};n[f]=function(){var e=r&&n.readyState;!i.done&&(!e||l[e])&&(e==="loaded"&&!i.loaded?(i.loaded=!0,setTimeout(n[f])):F(t,n,i))},n.onerror=function(e){M(i.error=e),F(t,n,i)},setTimeout(function(){_(t,n)}),i.timeout=setTimeout(function(){M("unknow"),F(t,n,i)},60500),g=i}else{try{e(n.text.replace(c,""))}catch(s){M(s)}D(t)}}function q(e){if(e)return g||(y=e.holder),I(e.holder,e.script=j(e.script)),!e.script.src}function R(){for(var e;e=q(S.shift()););return e!==!1&&!g}function U(e,t,n){r?(m.innerHTML="<img />"+t,D(m.firstChild)):m.innerHTML=t;var i=[],s=m.getElementsByTagName("script"),o,u;while(s[0])i.push({script:s[0],holder:P(s[0],B())});while(m.firstChild)v.appendChild(m.firstChild);return b===e?(S=(u=S.n.slice(S.l-S.length).concat(i)).concat(o=S.o),S.n=u,S.o=o,w.parentNode.insertBefore(v,w)):(S=i.concat(o=S),S.n=i,S.o=o,w=v.appendChild(w||B()),n?e.parentNode.insertBefore(v,e.nextSibling):P(e,v)),S.l=S.length,b=e,N&&i.length&&(N=R()),N}function z(e){return e&&e.html&&U(n.getElementById(e.id),e.html)}function W(){while(z(x=E.shift()));N&&!E.length&&(w&&D(w),g=y=b=w=s,n.write=k,n.writeln=L,T=!1)}function X(){N=!0;if(R()){try{x.callback&&x.callback(x.errors)}catch(e){M(e)}W()}}function V(e,t,n){"function"!=typeof n&&(n=s),"function"==typeof t&&(n=t,t=s),t||O('<span id="'+(t=a+o++)+'"></span>'),E.push({id:t,html:e,callback:n,errors:[]})}function $(e){var t,n,r=h.exec(e);while(r){n=r[1];if(-1===(t=e.indexOf("</"+n+">",r[0].length)))return d=n;r=h.exec(e=e.slice(t+n.length+3))}}function J(e){return!d||-1!==e.indexOf("</"+d+">")}function K(){var e=C.call(arguments,"");if(e)if($(e))p+=e;else if(J(e)){e=p+e,d=p="";if(T)try{U(y,e,!0)}catch(t){M(t)}else V(e)}else p+=e}function Q(){n.writeln=n.write=K}var o=1,u="text/lazyjs",a="lazy-holder-",f=r?"onreadystatechange":"onload",l={complete:1,loaded:1},c=/^\s*<!--/,h=/<([a-z]+)(?:\s+[a-z]+(?:=(?:'[^']*'|"[^"]*"|[^'">\s]*))?)*\s*>/i,p="",d="",v=n.createDocumentFragment(),m=H("div"),g=s,y=s,b=s,w=s,E=[],S=[],x=s,T=!1,N=!0,C=[].join,k=n.write,L=n.writeln,A=t.onerror,O=k.apply?function(){k.apply(n,arguments)}:k;return t.onerror=function(e,n){g&&n===g.src&&!g.error&&M(e),A&&A.apply(t,arguments)},i&&Q(),{write:O,prepare:Q,render:V,process:function(){if(T)return;T=!0,this.prepare(),W()},findScripts:function(e){e=e||u;var t=n.getElementsByTagName("script"),r=t.length-1,i=[],s,f,l;for(;-1<r;r--)e===t[r].type&&i.push(t[r]);for(;s=i.pop();){P(s,f=B());if(l=s.getAttribute("src"))_(m,H("script")).src=l;_(m,s),V(m.innerHTML,f.id=a+o++),m.innerHTML=""}}}},function(){eval.apply(window,arguments)},window,document,/*@cc_on!@*/!!1);
