/*
 * LazyWrite - deferred document.write implementation
 * Version: 1.0 beta build 20110221
 * Website: http://github.com/xfsn/LazyWrite
 * 
 * Copyright (c) 2011 Shen Junru
 * Released under the MIT License.
 */
(function(w,o,h){var D=1,g=!-[1,],y=g?"onreadystatechange":"onload",l=w.write,x=w.writeln,b=w.createDocumentFragment(),t=w.createElement("div"),z=h,s=h,i=h,j=h,e=[],f=[],r=false,c=true,k=[].join,E=function(H,G){return H.appendChild(G)},p=function(G){return G.parentNode?G.parentNode.removeChild(G):G},a=function(H,G){return H.parentNode.replaceChild(G,H)&&G},v=function(){return w.createElement("span")},C=function m(H){var G=w.createElement("script");G.type=H.type;if(H.src){G.src=H.src}else{G.text=H.text}return G},B=function(H,G){if(G.src){G[y]=function(){var J=g&&G.readyState;if(!G.done&&(!J||/complete|loaded/.test(J))){if(J==="loaded"&&!G.loaded){G.loaded=true;setTimeout(arguments.callee)}else{G.done=true;G[y]=null;p(H);if(s===G){s=h;d()}}}};s=G;setTimeout(function(){E(H,G)})}else{try{o(G.text)}catch(I){}p(H)}},u=function(G){if(G){if(!s){z=G.holder}B(G.holder,G.script=C(G.script));return !G.script.src}},A=function(G){while((G=u(f.shift()))){}return G!==false&&!s},q=function(J,K,I){if(g){t.innerHTML="<img />"+K;p(t.firstChild)}else{t.innerHTML=K}var H=[],G=t.getElementsByTagName("script");while(G[0]){H.push({script:G[0],holder:a(G[0],element=v())})}f=H.concat(f);while(t.firstChild){b.appendChild(t.firstChild)}if(i===J){j.parentNode.insertBefore(b,j)}else{j=b.appendChild(j||v());I?J.parentNode.insertBefore(b,J.nextSibling):a(J,b)}i=J;if(H.length){c=A()}return c},F=function(G){return G&&G.html&&q(w.getElementById(G.id),G.html)},n=function(G){while(F(e.shift())){}if(c&&!e.length){j&&p(j);b=t=z=s=i=j=h;w.write=l;w.writeln=x}},d=function(){c=true;if(A()){n()}};w.writeln=w.write=function(){var I,H=k.call(arguments,"");if(H){if(r){try{q(z,H,true)}catch(G){}}else{e.push({id:I="document_write_"+D++,html:H});I='<span id="'+I+'"></span>';l.call?l.call(w,I):l(I)}}};window.LazyWrite={write:function(){l.apply(w,arguments)},render:function(G,H){G&&H&&e.push({id:G,html:H})},start:function(){if(r){return}r=true;n()}}})(document,function(){eval.apply(window,arguments)});
