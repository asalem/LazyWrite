/*
 * LazyWrite - deferred document.write implementation
 * Version: 1.0 beta build 20110609
 * Website: http://github.com/xfsn/LazyWrite
 *
 * Copyright (c) 2011 Shen Junru
 * Released under the MIT License.
 */
(function(L,c,i,G,m){var C=1,a=i?"onreadystatechange":"onload",n=/^\s*<!--/,o="lazy-holder-",N="text/lazyjs",f=c.write,q=c.writeln,b=f.apply?function(){f.apply(c,arguments)}:f,d=c.createDocumentFragment(),M=c.createElement("div"),A=m,j=m,v=m,u=m,E=[],e=[],l=m,s=false,y=true,k=[].join,w=function(R){l.ex.push(R)},I=function(S,R){if(j&&(R===j.src)&&!j._error){w(S);return true}},r=function(S,R){return S.appendChild(R)},D=function(R){return R.parentNode?R.parentNode.removeChild(R):R},Q=function(S,R){return S.parentNode.replaceChild(R,S)&&R},H=function(){return c.createElement("span")},x=function t(S){var R=c.createElement("script");R.type=S.type;if(S.src){R.src=S.src}else{R.text=S.text}return R},J=function(S,R){R.done=true;R[a]=R.onerror=null;D(S);if(j===R){j=m;B()}},F=function(S,R){if(R.src){R[a]=function(){var U=i&&R.readyState;if(!R.done&&(!U||/complete|loaded/.test(U))){if(U==="loaded"&&!R.loaded){R.loaded=true;setTimeout(arguments.callee)}else{J(S,R)}}};R.onerror=function(U){R._error=U;w(U);J(S,R)};j=R;setTimeout(function(){r(S,R)})}else{try{G(R.text.replace(n,""))}catch(T){w(T)}D(S)}},h=function(R){if(R){if(!j){A=R.holder}F(R.holder,R.script=x(R.script));return !R.script.src}},p=function(R){while((R=h(e.shift()))){}return R!==false&&!j},O=function(U,V,T){if(i){M.innerHTML="<img />"+V;D(M.firstChild)}else{M.innerHTML=V}var S=[],R=M.getElementsByTagName("script");while(R[0]){S.push({script:R[0],holder:Q(R[0],element=H())})}e=S.concat(e);while(M.firstChild){d.appendChild(M.firstChild)}if(v===U){u.parentNode.insertBefore(d,u)}else{u=d.appendChild(u||H());T?U.parentNode.insertBefore(d,U.nextSibling):Q(U,d)}v=U;if(S.length){y=p()}return y},z=function(R){return R&&R.html&&O(c.getElementById(R.id),R.html)},P=function(){while(z(l=E.shift())){}if(y&&!E.length){u&&D(u);d=M=A=j=v=u=m;c.write=f;c.writeln=q}},B=function(){y=true;if(p()){try{l.cb&&l.cb(l.ex)}catch(R){w(R)}P()}},g=function(S,R,T){if(typeof T!=="function"){T=m}if(typeof R==="function"){T=R,R=m}R||b('<span id="'+(R=o+C++)+'"></span>');E.push({id:R,html:S,cb:T,ex:[]})},K=function(){var S=k.call(arguments,"");if(S){if(s){try{O(A,S,true)}catch(R){w(R)}}else{g(S)}}};(L.LazyWrite={write:b,render:g,prepare:function(){c.writeln=c.write=K},process:function(){if(s){return}s=true;P()},findScripts:function(V){V=V||N;var U,S,T=0,R=[].slice.call(c.querySelectorAll?c.querySelectorAll('script[type="'+V+'"]'):c.getElementsByTagName("script"));for(;T<R.length;T++){if(V===R[T].type){Q(R[T],U=H());if(S=R[T].getAttribute("require")){r(M,c.createElement("script")).src=S}r(M,R[T]);g(M.innerHTML,U.id=o+C++);M.innerHTML=""}}}}).prepare();L.onerror=I})(window,document,/*@cc_on!@*/!1,function(){eval.apply(window,arguments)});
